---
- name: Remove older Docker version
  become: yes
  apt: name='docker-engine' state='absent' update_cache='yes'
  tags: [ uninstall,docker-setup ]

- name: DOCKER aufs support
  become: yes
  apt: name=linux-image-extra-{{ ansible_kernel }} state=present
  tags: [ aufs,docker-setup ]

- name: Install linux image packages
  become: yes
  apt: name=linux-image-extra-virtual state=present
  tags: [ aufs,docker-setup ]

- name: Allow apt to use repository over HTTPS 
  apt: name={{ item }} state=present
  with_items:
    - "{{ apt_packages }}"
  tags: [ install,docker-setup ]

- name: Add Dockerâ€™s official GPG key
  shell: curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
  tags: [ add-key,docker-setup ]

- name: Set up the stable repository
  become: yes
  apt_repository:
     repo: "deb [arch=amd64] https://download.docker.com/linux/ubuntu trusty stable"
     state: present
     update_cache: yes
  tags: [ add-repo,docker-setup ]

- name: Docker install
  apt: name=docker-ce state=present
  tags: [ install,docker-setup ]

- name: DOCKER update firewall rule
  lineinfile: dest={{ firewall_file }} regexp={{ firewall_default }} line={{ firewall_accept }}

